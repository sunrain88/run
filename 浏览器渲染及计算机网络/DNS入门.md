# DNS入门

从地址栏输入地址到页面渲染出来，这中间到底发生了啥？读完本片文章，从此不再困惑

## DNS解析到底是啥玩意

在网络世界中真正发挥作用的是 `IP`，而一般情况下我们访问的都是 `域名`，为什么能实现这种效果，就是因为域名与IP地址的对应关系存储在一个叫做 `DNS（Domain Name System）` 的系统里。DNS是一个全球化的分布式数据库，它所提供的服务就是将域名转换为互联网IP地址。

## DNS解析全过程

![dns解析流程图](..\images\img1\dns解析流程图.png)

1. 浏览器缓存：一次请求会首先通过浏览器缓存信息寻找域名映射的IP地址，这也是为什么有时候我们改了本机hosts，需要关闭再打开浏览器才能正常使用，如果找到则返回，没找到则继续到下一级

2. 本机系统缓存：即上文中提到的，通过 `hosts` 文件来映射域名和IP，在上古时期有很多垃圾软件会悄咪咪的修改系统的 hosts文件，达到 `DNS劫持` 的目的，即把淘宝域名指向另一个 `IP`，然后部署一个高仿的淘宝商城，静静等你输入账号，密码，然后凉凉...

3. 本地域名解析服务系统：本地域名系统LDNS一般都是本地区的域名服务器。离你的位置都比较近，Windows系统使用命令`ipconfig` 就可以查看，在Linux和Mac系统下，直接使用命令 `cat /etc/resolv.conf` 来查看LDNS服务地址。 LDNS一般都缓存了大部分的域名解析的结果，大部分的解析工作到这里就差不多已经结束了

4. 根域名解析：本地域名解析服务系统无法解析时，会向 `13根` 发起域名解析请求

   > 说明： 所谓的 13根，指的是根域名服务器，是架构因特网所必须的基础设施。根服务器主要用来管理互联网的主目录，由于DNS解析中采用的是UDP协议，仅能传递512字节的有效报文，因此只能构建出A-M 13个根服务器，而真正工作运行肯定不止13台服务器，而是包含很多服务器镜像的

5. 根域名解析服务器返回 `gTLD (Generic top-level domain)` 给本地解析服务器，即该域名所属的顶级域及其所在的服务器，顶级域名即如：.com .cn等等

6. 本地解析服务器已知顶级域名服务器地址后，发起解析请求

7. 顶级域名解析服务器返回 `权限域名服务器` 信息给本地解析服务器，`权限域名服务器` 即如：taobao.com

8. 本地解析服务器已知权限域名服务器地址后，发起解析请求

9. 权限域名服务器返回域名对应的IP地址给本地解析服务器

10. 本地解析服务器缓存相关信息，并返回给用户

是不是有点绕？咱们来整个图吧，`递归解析` 如下所示：![递归解析流程图](..\images\img1\递归解析流程图.png)